#ifndef CLINICCHARGETABLE_H
#define CLINICCHARGETABLE_H
#include "histable.h"
#include "patient.h"
#include "clinicchargeitem.h"

//-----------------------------------------------------------------------------------------------------------------------------------
// 门诊收费单数据类
//-----------------------------------------------------------------------------------------------------------------------------------
class ClinicChargeTable : public HISTable
{
public:
    ClinicChargeTable();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getID
    // 作用：得到收费单单号
    // 参数：无
    // 返回值：
    // QString - 收费单单号
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    QString getID();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getNewClinicChargeID
    // 作用：根据年月日时分秒毫秒计算一个新的收费单单号
    // 参数：无
    // 返回值：
    // QString - 收费单编号
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    QString getNewClinicChargeID();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getDueIncome
    // 作用：得到应收金额
    // 参数：无
    // 返回值：
    // double - 应收金额
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    double getDueIncome() const;

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getRealImcome
    // 作用：得到实收金额
    // 参数：无
    // 返回值：
    // double - 实收金额
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    double getRealImcome() const;

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getPatient
    // 作用：得到收费单所属患者的信息
    // 参数：无
    // 返回值：
    // Patient - 收费单所属患者的信息
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    Patient getPatient() const;

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getChargeItems
    // 作用：得到收费项列表
    // 参数：无
    // 返回值：
    // QVector<ClinicChargeItem*> - 收费项详细列表
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    QVector<ClinicChargeItem*> getChargeItems() const;

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：getTime
    // 作用：得到收费单的保存时间
    // 参数：无
    // 返回值：
    // QDateTime - 门诊收费单在保存进数据库的时候会获得当前时间，在门诊日结的时候需要显示这个时间
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    QDateTime getTime() const;

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：setID
    // 作用：设置收费单号
    // 参数：
    // strID - 收费单号
    // 返回值：无
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    void setID(QString strID);

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：setDueIncome
    // 作用：设置应收金额
    // 参数：
    // d_DueIncome - 应收金额
    // 返回值：无
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    void setDueIncome(double d_DueIncome);

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：setRealIncome
    // 作用：设置实收金额
    // 参数：
    // d_RealIncome - 实收金额
    // 返回值：无
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    void setRealIncome(double d_RealIncome);

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：setChargeItems
    // 作用：设置收费详细列表
    // 参数：
    // chargeItems - 收费项详细列表
    // 返回值：无
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    void setChargeItems(QVector<ClinicChargeItem*> chargeItems);

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：setPatient
    // 作用：设置收费单所属患者
    // 参数：
    // patient - 患者
    // 返回值：无
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    void setPatient(Patient patient);


    bool Read();
    bool Save();
    bool Delete();

    static QVector<ClinicChargeTable*> selectClinicChargesFromDb(QDate date , QDateTime ReportTime);
protected:

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：readChargeTable
    // 作用：根据收费单号从数据库中读取一条收费单记录
    // 参数：无
    // 返回值：
    // true  - 读取成功
    // false - 读取失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool readChargeTable();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：ReadChargeRecords
    // 作用：根据收费单号从数据库中读取该收费单号对应的所有收费记录
    // 参数：无
    // 返回值：
    // true  - 读取成功
    // false - 读取失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool ReadChargeRecords();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：saveChargeRecords
    // 作用：将该收费单的所有收费记录保存到数据库
    // 参数：无
    // 返回值：
    // true  - 保存成功
    // false - 保存失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool saveChargeRecords();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：saveChargeTable
    // 作用：将该收费单保存到数据库
    // 参数：无
    // 返回值：
    // true  - 读取成功
    // false - 读取失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool saveChargeTable();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：deleteChargeTable
    // 作用：根据自身单号从数据库中删除收费单
    // 参数：无
    // 返回值：
    // true  - 删除成功
    // false - 删除失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool deleteChargeTable();

    //-----------------------------------------------------------------------------------------------------------------------------------
    // 名称：deleteChargeRecords
    // 作用：根据自身单号从数据库中删除收费单对应的所有收费记录
    // 参数：无
    // 返回值：
    // true  - 删除成功
    // false - 删除失败
    // 备注：无
    // 时间：2016-04-20
    //-----------------------------------------------------------------------------------------------------------------------------------
    bool deleteChargeRecords();

protected:
    QString m_strID;                          // 收费单单号
    QString m_strPrefixion;                   // 收费单单号前缀
    double m_dDueIncome;                      // 应收金额
    double m_dRealIncome;                     // 实收金额
    Patient m_patient;                        // 患者
    QDateTime m_time;                         // 保存进数据库的时间
    QString m_strMaker;                       // 制单员
    QVector<ClinicChargeItem*> m_chargeItems; // 收费明细列表
};

#endif // CLINICCHARGETABLE_H
